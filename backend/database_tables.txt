ALTER TABLE auth_user
ADD COLUMN is_vendedor BOOLEAN DEFAULT FALSE;

ALTER TABLE auth_user
ADD COLUMN is_gerente BOOLEAN DEFAULT FALSE;



CREATE TABLE Clientes (
    id SERIAL PRIMARY KEY,
    nome VARCHAR(255) NOT NULL,
    endereco VARCHAR(255),
    telefone INTEGER,
    email VARCHAR(255) UNIQUE,
    gestor_id INTEGER,
    FOREIGN KEY (gestor_id) REFERENCES auth_user(id) ON DELETE SET NULL
);


-- Criação da tabela Produtos
CREATE TABLE Produtos (
    id SERIAL PRIMARY KEY,
    nome VARCHAR(255) NOT NULL,
    descricao TEXT,
    valor_minimo_venda DECIMAL(10, 2) NOT NULL,
    valor_maximo_venda DECIMAL(10, 2) NOT NULL,
    foto BYTEA
);

-- Criação da tabela Vendas
CREATE TABLE Vendas (
    id SERIAL PRIMARY KEY,
    data_venda TIMESTAMP NOT NULL DEFAULT NOW(),
    cliente_id INTEGER NOT NULL,
    CONSTRAINT fk_cliente
        FOREIGN KEY (cliente_id) 
        REFERENCES clientes(id) 
        ON DELETE CASCADE
);

-- Criação da tabela VendasItens
CREATE TABLE VendasItens (
    id SERIAL PRIMARY KEY,
    venda_id INTEGER NOT NULL,
    produto_id INTEGER NOT NULL,
    quantidade INTEGER NOT NULL,
    preco_unitario DECIMAL(10, 2) NOT NULL,
    CONSTRAINT fk_venda
        FOREIGN KEY (venda_id)
        REFERENCES Vendas(id) 
        ON DELETE CASCADE,
    CONSTRAINT fk_produto
        FOREIGN KEY (produto_id)
        REFERENCES Produtos(id)
        ON DELETE CASCADE
);








CREATE TABLE EstoqueExtrato (
    id SERIAL PRIMARY KEY,
    data TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    produto_id INT NOT NULL,
    tipo INT CHECK (tipo IN (1, 2)),  -- 1 = Entrada, 2 = Saída
    tipomov INT CHECK (tipomov IN (1, 2)),  -- 1 = CI, 2 = VENDA
    iddoc INT NOT NULL,
    FOREIGN KEY (produto_id) REFERENCES Produtos(id)
);

CREATE TABLE SaldoEstoque (
    id SERIAL PRIMARY KEY,
    produto_id INT NOT NULL,
    gestor_id INT NOT NULL,
    saldo DECIMAL(10, 2) NOT NULL DEFAULT 0.00,
    FOREIGN KEY (produto_id) REFERENCES Produtos(id),
    FOREIGN KEY (gestor_id) REFERENCES auth_user(id)
);


-- Adiciona a coluna trava_preco_adm
ALTER TABLE produtos
ADD COLUMN trava_preco_adm BOOLEAN DEFAULT FALSE;

-- Adiciona a coluna preco_fixo_adm
ALTER TABLE produtos
ADD COLUMN preco_fixo_adm NUMERIC(10, 2);

